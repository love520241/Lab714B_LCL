window.addEvent("domready",function(){Init()});window.addEvent("beforeunload",function(b){if(disableNavigateWarning){disableNavigateWarning=false;return}if(isPageConsistent){var a="You have attempted to leave this page. If you have made any changes, they will be lost.";var b=b||window.event;if(b){b.returnValue=a}return a}});var pageImageWidth=0;var pageImageHeight=0;var dpi=200;var zoom=1;var zoomFitPage=false;var zoomFitHoriz=false;var canvas=null;var tree=null;var currPage=0;var pageCount=0;var isPageConsistent=false;var disableNavigateWarning=false;var ServerUrl="Default.aspx";var colorPicker=null;var lastHighlightColor="rgb(255, 255, 0)";var isUpdatingTextControls=false;function Scale(a){return Math.round(a*zoom)}function InvScale(a){return Math.floor(a/zoom)}function FitPageImage(i){var e=10;var b=document.getElementById("page_img");b.style.width="0px";b.style.height="0px";RemoveAllChildren(canvas.hyperlinksDiv);RemoveAllChildren(canvas.annotsDiv);RemoveAllChildren(canvas.wordSelectionDiv);var c=document.getElementById("page_panel");var a=c.clientWidth-e*2;var f=c.clientHeight-e*2;if(i){for(var d=0;d<20;++d){if(pageImageWidth>a||pageImageHeight>f){var h=a/pageImageWidth;var g=f/pageImageHeight;zoom=Math.min(h,g);if(zoom<=0){zoom=1}b.style.width=Math.round(pageImageWidth*zoom)+"px";b.style.height=Math.round(pageImageHeight*zoom)+"px"}else{zoom=1;b.width=pageImageWidth;b.height=pageImageHeight}if(a>c.clientWidth-e*2){--f}else{break}}}else{if(pageImageWidth>a){zoom=a/pageImageWidth;b.style.width=Math.round(pageImageWidth*zoom)+"px";b.style.height=Math.round(pageImageHeight*zoom)+"px"}else{zoom=1;b.style.width=pageImageWidth+"px";b.style.height=pageImageHeight+"px"}if(b.height>f){a=c.clientWidth-e*2;if(pageImageWidth>a){zoom=a/pageImageWidth;b.style.width=Math.round(pageImageWidth*zoom)+"px";b.style.height=Math.round(pageImageHeight*zoom)+"px"}}}UpdateZoom(zoom)}function UpdateZoom(b){SetButtonDisabled("zoom_in",(b>=1));SetButtonDisabled("zoom_out",(b<=0.25));var a=document.getElementById("zoom_label");a.innerHTML=Math.floor(b*100)+"%";canvas.SetZoom(b);canvas.Redraw()}function ZoomPageImage(b){var c=document.getElementById("page_panel");var a=document.getElementById("page_img");a.style.width=Math.round(pageImageWidth*b)+"px";a.style.height=Math.round(pageImageHeight*b)+"px";UpdateZoom(b)}function PageResize(){var a=document.getElementById("properties_panel").clientHeight;document.getElementById("page_panel").style.bottom=a+"px";if(canvas){canvas.Redraw()}}function ZoomIn(){if(zoom>=1){return}else{if(zoom>=0.6666){zoom=1}else{if(zoom>=0.5){zoom=0.6666}else{if(zoom>=0.3333){zoom=0.5}else{zoom=0.3333}}}}ZoomPageImage(zoom)}function ZoomOut(){if(zoom<=0.25){return}else{if(zoom<=0.3333){zoom=0.25}else{if(zoom<=0.5){zoom=0.3333}else{if(zoom<=0.6666){zoom=0.5}else{zoom=0.6666}}}}ZoomPageImage(zoom)}function ZoomFitPage(){FitPageImage(true)}function ZoomFitHoriz(){FitPageImage(false)}function UpdateTextControls(a){isUpdatingTextControls=true;document.getElementById("text_properties").style.display="";SetButtonDisabled("delete_text_button",!a.isSelected);document.getElementById("text_font").value=a.font;document.getElementById("text_size").value=a.size.toString();SetCheckButton(document.getElementById("text_bold"),a.bold);SetCheckButton(document.getElementById("text_italic"),a.italic);document.getElementById("text_color").style.backgroundColor=a.color;SetCheckButton(document.getElementById("text_border"),a.border);if(!a.background){document.getElementById("text_background_color").style.backgroundImage="url(images/props/Background2Transparent.png)";document.getElementById("text_background_color").style.backgroundColor="transparent"}else{document.getElementById("text_background_color").style.backgroundImage="url(images/props/Background2.png)";document.getElementById("text_background_color").style.backgroundColor=a.backgroundColor}isUpdatingTextControls=false}function SelectionChanged(g){if(canvas.currSelections&&canvas.currSelections.length>0){document.getElementById("make_link_button").style.display="";document.getElementById("make_highlight_button").style.display=""}else{document.getElementById("make_link_button").style.display="none";document.getElementById("make_highlight_button").style.display="none"}var a=false;for(var e=0;e<canvas.textAnnots.length;++e){if(canvas.textAnnots[e].isSelected){a=true;UpdateTextControls(canvas.textAnnots[e]);break}}if(!a){SetButtonDisabled("delete_text_button",true);if(canvas.tool!=CanvasTools.TextTool){document.getElementById("text_properties").style.display="none"}}var h=false;for(var e=0;e<canvas.hyperlinks.length;++e){if(canvas.hyperlinks[e].isSelected){h=true;if(canvas.hyperlinks[e].linkType==LinkTypes.URL){document.getElementById("link_type_external").checked=true;document.getElementById("external_link_properties").style.display="";document.getElementById("internal_link_properties").style.display="none";var d=canvas.hyperlinks[e].url?canvas.hyperlinks[e].url:"";document.getElementById("link_url").value=d;if(g&&g.ctrlKey){if(d.indexOf("http://")!=0&&d.indexOf("https://")!=0){d="http://"+d}window.open(d,"Follow URL","")}}else{var b=canvas.hyperlinks[e].pageNo;var f=(b==undefined||isNaN(b)||b<=0||b>pageCount);if(g&&g.ctrlKey&&!f){h=false;JumpToPage(b-1);break}else{document.getElementById("link_type_internal").checked=true;document.getElementById("external_link_properties").style.display="none";document.getElementById("internal_link_properties").style.display="";document.getElementById("link_page").style.backgroundColor=f?"red":"";document.getElementById("link_page").value=f?"":b.toString()}}document.getElementById("link_properties").style.display="";break}}if(!h){document.getElementById("link_properties").style.display="none"}var c=false;for(var e=0;e<canvas.highlights.length;++e){if(canvas.highlights[e].isSelected){c=true;document.getElementById("highlight_properties").style.display="";document.getElementById("highlight_color").style.backgroundColor=canvas.highlights[e].color}}if(!c){document.getElementById("highlight_properties").style.display="none"}}function ColorPickerChanged(a){if(document.getElementById("text_properties").style.display!="none"){if(colorPicker.lastElement==document.getElementById("text_color")){document.getElementById("text_color").style.backgroundColor=a}else{if(colorPicker.lastElement==document.getElementById("text_background_color")){if(a==""){document.getElementById("text_background_color").style.backgroundImage="url(images/props/Background2Transparent.png)";document.getElementById("text_background_color").style.backgroundColor="transparent"}else{document.getElementById("text_background_color").style.backgroundImage="url(images/props/Background2.png)";document.getElementById("text_background_color").style.backgroundColor=a}}}TextChanged()}if(document.getElementById("highlight_properties").style.display!="none"){document.getElementById("highlight_color").style.backgroundColor=a;HighlightChanged()}}function FeedTree(d,g){var j=new Array();j.push(g);for(var e=0;e<d.length;e+=3){var b=d[e];var h=d[e+1];var a=d[e+2];var f=b>0?j[b-1]:g;var c=Math.uuidFast();tree.insertNewChild(f,c,EncodeStringForHtml(h),0,0,0,0,"");tree.setUserData(c,"pageNo",a);while(j.length-1<b){j.push(g)}j[b]=c}}function GetJsonFromTree(f,e,d){if(d==null){d=1;tree.stopEdit()}var b=tree.getSubItems(f);if(b==""){return}var a=b.split(",");for(var c=0;c<a.length;++c){e.push(d);e.push(DecodeStringFromHtml(tree.getItemText(a[c])));e.push(tree.getUserData(a[c],"pageNo"));GetJsonFromTree(a[c],e,d+1)}}function TreeSelChange(c){var b=(c!="");var a=null;if(b){a=tree.getUserData(c,"pageNo")}SetButtonDisabled("up",!b);SetButtonDisabled("down",!b);SetButtonDisabled("left",!b);SetButtonDisabled("delete_bookmark",!b);document.getElementById("bookmark_page").disabled=!b;document.getElementById("bookmark_page").style.backgroundColor="";document.getElementById("bookmark_page").value=!b?"":(a>0?a.toString():"");document.getElementById("page_no_edit").disabled=false;if(b&&a>0&&a<=pageCount){JumpToPage(a-1)}}function TreeMove(b){var c=tree.getSelectedItemId();var a=(c!="");if(a){tree.enableItemEditor(false);tree.moveItem(c,b);tree.selectItem(c,true);tree.enableItemEditor(true)}}function DisplayLoadError(){document.getElementById("page_img").style.visibility="hidden";document.getElementById("page_error").style.visibility="visible";document.getElementById("page_error_message").innerHTML=(pageCount==0)?"Error loading document":"Error loading page"}function LoadDocument(){try{var b=zXmlHttp.createRequest();b.open("get",ServerUrl+"?op=getdoc",true);b.onreadystatechange=function(){if(b.readyState==4){if(b.status==200){var c=JSON.parse(b.responseText);if(c&&c.error){if(c.error=="Not uploaded"){location.replace("index.html");return}else{DisplayLoadError()}}FeedTree(c.bookmarks,0);pageCount=c.pageCount;UpdateNavigation()}}};b.send(null)}catch(a){DisplayLoadError()}}function LoadPage(a){try{var c=zXmlHttp.createRequest();c.open("get",ServerUrl+"?op=getpage&pg="+(currPage+1).toString(),true);c.onreadystatechange=function(){if(c.readyState==4){if(c.status==200){document.getElementById("page_error").style.visibility="hidden";document.getElementById("page_img").style.visibility="visible";var d=JSON.parse(c.responseText);if(d&&d.error){if(d.error=="Not uploaded"){location.replace("index.html");return}}RemoveAllChildren(canvas.hyperlinksDiv);RemoveAllChildren(canvas.annotsDiv);RemoveAllChildren(canvas.wordSelectionDiv);document.getElementById("page_img").onload=function(){canvas.LoadData(d.words,d.annots.hyperlinks,d.annots.textAnnots,d.annots.highlights);isPageConsistent=true};pageImageWidth=d.w;pageImageHeight=d.h;canvas.LoadImage(pageImageWidth,pageImageHeight,ServerUrl+"?op=pageimage&pg="+(currPage+1).toString());if(a){ZoomFitPage()}else{ZoomPageImage(zoom)}var e=document.getElementById("page_panel");if(e){e.scrollTop=0;e.scrollLeft=0}}else{DisplayLoadError();UpdateNavigation()}}};c.send(null)}catch(b){DisplayLoadError()}}function ToolChanged(a){if(a=="selection_tool_button"){canvas.SetTool(CanvasTools.SelectionTool);if(!canvas.IsTextAnnotSelected()){document.getElementById("text_properties").style.display="none"}}else{if(a=="text_tool_button"){canvas.SetTool(CanvasTools.TextTool);UpdateTextControls(canvas.defaultTextAnnot);SetButtonDisabled("delete_text_button",!canvas.IsTextAnnotSelected())}}}function Init(){if(msieversion()>=9){document.getElementById("page_img").style.msInterpolationMode="bicubic"}window.onresize=function(){PageResize()};var a=document.getElementById("tree_splitter");splitterLastX=clipPx(a.style.left);a.ondblclick=SplitterDblClick;a.onmousedown=SplitterMouseDown;a.onselectstart=function(){return false};if(document.addEventListener){document.addEventListener("mousemove",SplitterMouseMove,false);document.addEventListener("mouseup",SplitterMouseUp,false)}else{if(document.attachEvent){document.attachEvent("onmousemove",SplitterMouseMove);document.attachEvent("onmouseup",SplitterMouseUp)}}document.getElementById("main_panel").ondrag=function(){return false};document.getElementById("page_panel").onselectstart=function(){return false};document.getElementById("annots").onselectstart=function(){return false};MakeButton("up",null);MakeButton("down",null);MakeButton("left",null);MakeButton("insert_bookmark",null);MakeButton("delete_bookmark",null);MakeButton("prev_page",null);MakeButton("next_page",null);MakeButton("zoom_fit_page",null);MakeButton("zoom_fit_horiz",null);MakeButton("zoom_in",null);MakeButton("zoom_out",null);MakeRadioButtonGroup(["selection_tool_button","text_tool_button"],ToolChanged);MakeButton("make_link_button",MakeLink);MakeButton("make_highlight_button",MakeHighlight);MakeButton("delete_link_button",DeleteSelectedLink);MakeButton("delete_highlight_button",DeleteSelectedHighlight);MakeButton("delete_text_button",DeleteSelectedText);MakeCheckButton("text_bold",TextChanged);MakeCheckButton("text_italic",TextChanged);MakeCheckButton("text_border",TextChanged);MakeCheckButton("show_bookmarks",ToggleBookmarksPanelClick);SetCheckButton("show_bookmarks",true);document.getElementById("up").onclick=function(){TreeMove("up")};document.getElementById("down").onclick=function(){TreeMove("down")};document.getElementById("left").onclick=function(){TreeMove("left")};document.getElementById("insert_bookmark").onclick=function(){InsertBookmark()};document.getElementById("delete_bookmark").onclick=function(){DeleteBookmark()};document.getElementById("bookmark_page").onchange=function(){BookmarkPageChanged()};document.getElementById("bookmark_page").onkeyup=function(){BookmarkPageChanged()};document.getElementById("prev_page").onclick=function(){PrevPage()};document.getElementById("page_no_edit").onchange=function(){CurrPageEditChanged()};document.getElementById("page_no_edit").onkeyup=function(){CurrPageEditKeyUp(event)};document.getElementById("next_page").onclick=function(){NextPage()};document.getElementById("zoom_in").onclick=function(){ZoomIn()};document.getElementById("zoom_out").onclick=function(){ZoomOut()};document.getElementById("zoom_fit_page").onclick=function(){ZoomFitPage()};document.getElementById("zoom_fit_horiz").onclick=function(){ZoomFitHoriz()};document.getElementById("download").onclick=function(){Download(true)};document.getElementById("upload").onclick=function(){UploadANewFile()};document.getElementById("errors_OK").onclick=function(){document.getElementById("errors_div").style.visibility="hidden"};document.getElementById("confirm_No").onclick=function(){document.getElementById("confirm_dialog").style.visibility="hidden"};document.getElementById("link_type_internal").onclick=function(){LinkTypeChanged()};document.getElementById("link_type_external").onclick=function(){LinkTypeChanged()};document.getElementById("link_url").onchange=function(){LinkUrlChanged()};document.getElementById("link_url").onkeyup=function(){LinkUrlChanged()};document.getElementById("link_page").onchange=function(){LinkPageChanged()};document.getElementById("link_page").onkeyup=function(){LinkPageChanged()};document.getElementById("highlight_color").onclick=function(){colorPicker.PopUp(this)};document.getElementById("text_font").onchange=function(){TextChanged()};document.getElementById("text_size").onchange=function(){TextChanged()};document.getElementById("text_color").onclick=function(){colorPicker.PopUp(this)};document.getElementById("text_background_color").onclick=function(){colorPicker.PopUp(this,true)};document.getElementById("link_properties").style.display="none";document.getElementById("external_link_properties").style.display="none";document.getElementById("internal_link_properties").style.display="none";document.getElementById("highlight_properties").style.display="none";document.getElementById("text_properties").style.display="none";document.getElementById("make_link_button").style.display="none";document.getElementById("make_highlight_button").style.display="none";DockSplitterTo(0);canvas=new Canvas();canvas.onSelectionChange=SelectionChanged;tree=new dhtmlXTreeObject("tree1","100%","100%",0);tree.setImagePath("./images/tree/");tree.enableDragAndDrop(true);tree.setDragBehavior("complex");tree.enableItemEditor(true);tree.setOnEditHandler(function(d,e,b,c){if(d==0){return DecodeStringFromHtml(c)}else{if(d==2){return EncodeStringForHtml(c)}}return true});tree.attachEvent("onSelect",TreeSelChange);TreeSelChange("");isPageConsistent=false;LoadDocument();currPage=0;LoadPage(true);UpdateNavigation();upclick({element:document.getElementById("uploader"),action:"Default.aspx?op=upload",onstart:function(b){document.getElementById("confirm_dialog").style.visibility="hidden";return true},oncomplete:function(b){if(b=="OK"){location.replace("editor.html")}else{alert(b)}}});colorPicker=new ColorPicker();colorPicker.trigger=document.getElementById("text_color");colorPicker.onColorSelected=ColorPickerChanged;MakeColorButton("highlight_color",colorPicker);MakeColorButton("text_color",colorPicker);MakeColorButton("text_background_color",colorPicker,true,true);SelectRadioButton("selection_tool_button")}function MakeLink(){if(canvas.currSelections&&canvas.currSelections.length>0){for(var a=0;a<canvas.currSelections.length;++a){var b=new UnknownLink(canvas.currSelections[a]);b.isSelected=true;canvas.hyperlinks.push(b)}}canvas.RemoveTextSelection();canvas.PopulateHyperlinks();canvas.onSelectionChange()}function MakeHighlight(){if(canvas.currSelections&&canvas.currSelections.length>0){for(var b=0;b<canvas.currSelections.length;++b){var a=new HighlightAnnot(canvas.currSelections[b],lastHighlightColor);a.isSelected=true;canvas.highlights.push(a)}}canvas.RemoveTextSelection();canvas.PopulateAnnots();canvas.onSelectionChange()}function DeleteSelectedLink(){for(var a=0;a<canvas.hyperlinks.length;){if(canvas.hyperlinks[a].isSelected){canvas.hyperlinks.splice(a,1)}else{++a}}canvas.Deselect();canvas.PopulateHyperlinks()}function DeleteSelectedHighlight(){for(var a=0;a<canvas.highlights.length;){if(canvas.highlights[a].isSelected){canvas.highlights.splice(a,1)}else{++a}}canvas.Deselect();canvas.PopulateAnnots()}function HighlightChanged(){for(var a=0;a<canvas.highlights.length;++a){if(canvas.highlights[a].isSelected){canvas.highlights[a].color=document.getElementById("highlight_color").style.backgroundColor;canvas.UpdateSelectedHighlightAnnot();lastHighlightColor=canvas.highlights[a].color}}}function LinkTypeChanged(){var b=document.getElementById("link_type_external").checked;document.getElementById("external_link_properties").style.display=b?"":"none";document.getElementById("internal_link_properties").style.display=b?"none":"";for(var a=0;a<canvas.hyperlinks.length;++a){if(canvas.hyperlinks[a].isSelected){canvas.hyperlinks[a].linkType=b?LinkTypes.URL:LinkTypes.Page}}}function LinkUrlChanged(){var a=document.getElementById("link_url").value;for(var b=0;b<canvas.hyperlinks.length;++b){if(canvas.hyperlinks[b].isSelected){canvas.hyperlinks[b].url=a}}}function LinkPageChanged(){var c=document.getElementById("link_page").value;document.getElementById("link_page").style.backgroundColor=IsValidUnsignedStr(c)?"":"red";var a=parseInt(c);for(var b=0;b<canvas.hyperlinks.length;++b){if(canvas.hyperlinks[b].isSelected){canvas.hyperlinks[b].pageNo=a}}}function TextChanged(){if(isUpdatingTextControls){return}for(var c=0;c<canvas.textAnnots.length;++c){if(canvas.textAnnots[c].isSelected){canvas.textAnnots[c].font=document.getElementById("text_font").value;canvas.textAnnots[c].size=parseInt(document.getElementById("text_size").value);canvas.textAnnots[c].bold=document.getElementById("text_bold").checked;canvas.textAnnots[c].italic=document.getElementById("text_italic").checked;canvas.textAnnots[c].color=document.getElementById("text_color").style.backgroundColor;canvas.textAnnots[c].border=document.getElementById("text_border").checked;var b=document.getElementById("text_background_color").style.backgroundColor;var a=(b.indexOf("rgb")>=0);canvas.textAnnots[c].background=a;if(a){canvas.textAnnots[c].backgroundColor=b}canvas.UpdateSelectedTextAnnot();canvas.defaultTextAnnot=new TextAnnot(0,0,canvas.textAnnots[c].text,canvas.textAnnots[c].font,canvas.textAnnots[c].size,canvas.textAnnots[c].bold,canvas.textAnnots[c].italic,canvas.textAnnots[c].color,canvas.textAnnots[c].border,canvas.textAnnots[c].background,canvas.textAnnots[c].backgroundColor)}}}function DeleteSelectedText(){canvas.DeleteSelectedTextAnnot()}function UpdateNavigation(){SetButtonDisabled("prev_page",(currPage<=0));SetButtonDisabled("next_page",(currPage>=pageCount-1));document.getElementById("page_no_label").style.display=pageCount==0?"none":"";document.getElementById("page_no_edit").value=(currPage+1).toString();document.getElementById("page_no_edit").style.backgroundColor="";document.getElementById("page_count_label").innerHTML=pageCount.toString();var a=(pageCount==0||currPage<0||currPage>=pageCount)}function ValidateCurrPageEdit(){var c=document.getElementById("page_no_edit").value;var a=-1;var b=IsValidUnsignedStr(c);if(b){a=parseInt(c);b=a>=1&&a<=pageCount}return{isValid:b,pageNo:a}}function CurrPageEditKeyUp(b){var c=document.getElementById("page_no_edit").value;var a=ValidateCurrPageEdit();document.getElementById("page_no_edit").style.backgroundColor=a.isValid||c==""?"":"red";if(b.keyCode==13){CurrPageEditChanged()}}function CurrPageEditChanged(){var a=ValidateCurrPageEdit();if(a.isValid){document.getElementById("page_no_edit").blur();JumpToPage(a.pageNo-1)}else{document.getElementById("page_no_edit").value=(currPage+1).toString();document.getElementById("page_no_edit").style.backgroundColor=""}}function PrevPage(){if(!isPageConsistent||currPage<=0){return}if(SavePageSync()){if(currPage>0){isPageConsistent=false;--currPage;LoadPage();UpdateNavigation()}}}function NextPage(){if(!isPageConsistent||currPage>=pageCount-1){return}if(SavePageSync()){if(currPage<pageCount-1){isPageConsistent=false;++currPage;LoadPage();UpdateNavigation()}}}function JumpToPage(a){if(!isPageConsistent||a>=0&&a<pageCount&&a!=currPage){if(SavePageSync()){isPageConsistent=false;currPage=a;LoadPage();UpdateNavigation()}}}function SavePageAsync(a){if(!isPageConsistent){a();return}canvas.Deselect();try{var d=zXmlHttp.createRequest();d.open("post",ServerUrl+"?op=savepage&pg="+(currPage+1).toString(),true);d.onreadystatechange=function(){if(d.readyState==4){if(d.status==200){a()}}};d.setRequestHeader("Content-type","application/json");var c={hyperlinks:canvas.hyperlinks,textAnnots:canvas.textAnnots,highlights:canvas.highlights};d.send(JSON.stringify(c))}catch(b){}}function SavePageSync(){if(!isPageConsistent){return true}canvas.Deselect();try{var c=zXmlHttp.createRequest();c.open("post",ServerUrl+"?op=savepage&pg="+(currPage+1).toString(),false);c.setRequestHeader("Content-type","application/json");var b={hyperlinks:canvas.hyperlinks,textAnnots:canvas.textAnnots,highlights:canvas.highlights};c.send(JSON.stringify(b));return(c.status==200)}catch(a){return false}}function SaveBookmarksAsync(a){try{var d=zXmlHttp.createRequest();d.open("post",ServerUrl+"?op=savebookmarks",true);d.onreadystatechange=function(){if(d.readyState==4){if(d.status==200){a()}}};d.setRequestHeader("Content-type","application/json");var c=new Array();GetJsonFromTree(0,c);d.send(JSON.stringify(c))}catch(b){}}function SaveBookmarksSync(){try{var c=zXmlHttp.createRequest();c.open("post",ServerUrl+"?op=savebookmarks",false);c.setRequestHeader("Content-type","application/json");var b=new Array();GetJsonFromTree(0,b);c.send(JSON.stringify(b));return(c.status==200)}catch(a){return false}}function DeleteBookmark(){tree.stopEdit();var g=tree.getSelectedItemId();if(g!=""){var d=null;var f=tree.getParentId(g);var a=tree.getSubItems(f);if(a!=""){var c=a.split(",");if(c.length>1){var e=-1;for(var b=0;b<c.length;++b){if(c[b]==g){e=b}}if(e>=0){d=e<c.length-1?c[e+1]:c[e-1]}}}if(d==null){tree.deleteItem(g,true)}else{tree.deleteItem(g,false);tree.selectItem(d,true)}}}function InsertBookmark(){tree.stopEdit();var b=tree.getSelectedItemId();var a=Math.uuidFast();if(b!=""){tree.insertNewNext(b,a,"",0,0,0,0,"")}else{tree.insertNewChild(0,a,"",0,0,0,0,"")}tree.selectItem(a,true);tree.editItem(a)}function InsertBookmarkChild(){tree.stopEdit();var b=tree.getSelectedItemId();if(b!=""){var a=Math.uuidFast();tree.insertNewChild(b,a,"",0,0,0,0,"");tree.selectItem(a,true);tree.editItem(a)}}function PushBookmark(){tree.stopEdit();var a=Math.uuidFast();tree.insertNewChild(0,a,"",0,0,0,0,"");tree.selectItem(a,true);tree.editItem(a)}function BookmarkPageChanged(){var c=document.getElementById("bookmark_page").value;document.getElementById("bookmark_page").style.backgroundColor=IsValidUnsignedStr(c)?"":"red";var a=parseInt(c);var b=tree.getSelectedItemId();if(b!=""){tree.setUserData(b,"pageNo",a)}}function Download(b){document.getElementById("please_wait").style.visibility="visible";if(SavePageSync()){if(SaveBookmarksSync()){try{var c=zXmlHttp.createRequest();c.open("post",ServerUrl+"?op=validate",true);c.onreadystatechange=function(){if(c.readyState==4){if(c.status==200){document.getElementById("please_wait").style.visibility="hidden";var h=null;if(c.responseText!=""){h=JSON.parse(c.responseText)}if(h==null||h.length==0){if(b){disableNavigateWarning=true;window.location.href=ServerUrl+"?op=download"}else{document.getElementById("preview_background").style.visibility="visible";document.getElementById("preview_panel").style.visibility="visible";document.getElementById("preview_background").onclick=document.getElementById("preview_header").onclick=function(){document.getElementById("preview_background").style.visibility="hidden";document.getElementById("preview_panel").style.visibility="hidden";document.getElementById("preview_iframe").src=""};document.getElementById("preview_iframe").src=ServerUrl+"?op=preview&rnd="+RandomString(24)}}else{var g="<p>The following error"+(h.length>1?"s have":" has")+" occurred:</p><p><table border='1'><tr><td>Page</td><td>Message</td></tr>";for(var e=0;e<h.length;++e){var d=h[e].pageNo;var f=h[e].errMsg;g+="<tr><td>"+(d==0?"n/a":d.toString())+"</td><td>"+f+"</td></tr>"}g+="</table></p>";document.getElementById("errors_placeholder").innerHTML=g;document.getElementById("errors_div").style.visibility="visible"}}}};c.setRequestHeader("Content-type","application/json");c.send(null)}catch(a){}}}}function UploadANewFile(){document.getElementById("confirm_dialog").style.visibility="visible"};