var GripSize=8;var GripDistance=5;var GripTop=2;var GripLeft=4;var GripRight=5;var GripBottom=7;var GripTopLeft=1;var GripTopRight=3;var GripBottomLeft=6;var GripBottomRight=8;function GripSet(d,c,e){var f=this;this.rect=c?new Rect(c.x,c.y,c.w,c.h):new Rect(0,0,0,0);this.ownerElem=e?e:document.body;this.onresize=null;this.onuserresize=null;this.onlimitsize=null;this.isDragging=false;this.groupCount=d?d:4;this.dragGripIndex=0;this.dragStartPos={x:0,y:0};this.dragStartRect=new Rect(0,0,0,0);this.gripTopLeft=this.NewGrip(GripTopLeft);this.gripTopRight=this.NewGrip(GripTopRight);this.gripBottomLeft=this.NewGrip(GripBottomLeft);this.gripBottomRight=this.NewGrip(GripBottomRight);if(this.groupCount==8){this.gripTop=this.NewGrip(GripTop);this.gripLeft=this.NewGrip(GripLeft);this.gripRight=this.NewGrip(GripRight);this.gripBottom=this.NewGrip(GripBottom)}this.ResizeRect(c.x,c.y,c.w,c.h);var b=function(i){i=i||window.event;if(f.isDragging){var j=GetMouseCoords(i);var h=j.x-f.dragStartPos.x;var g=j.y-f.dragStartPos.y;switch(f.dragGripIndex){case GripTop:f.UserResizeRect(f.dragStartRect.x,f.dragStartRect.y+g,f.dragStartRect.w,f.dragStartRect.h-g);break;case GripLeft:f.UserResizeRect(f.dragStartRect.x+h,f.dragStartRect.y,f.dragStartRect.w-h,f.dragStartRect.h);break;case GripRight:f.UserResizeRect(f.dragStartRect.x,f.dragStartRect.y,f.dragStartRect.w+h,f.dragStartRect.h);break;case GripBottom:f.UserResizeRect(f.dragStartRect.x,f.dragStartRect.y,f.dragStartRect.w,f.dragStartRect.h+g);break;case GripTopLeft:f.UserResizeRect(f.dragStartRect.x+h,f.dragStartRect.y+g,f.dragStartRect.w-h,f.dragStartRect.h-g);break;case GripTopRight:f.UserResizeRect(f.dragStartRect.x,f.dragStartRect.y+g,f.dragStartRect.w+h,f.dragStartRect.h-g);break;case GripBottomLeft:f.UserResizeRect(f.dragStartRect.x+h,f.dragStartRect.y,f.dragStartRect.w-h,f.dragStartRect.h+g);break;case GripBottomRight:f.UserResizeRect(f.dragStartRect.x,f.dragStartRect.y,f.dragStartRect.w+h,f.dragStartRect.h+g);break}if(f.onuserresize){f.onuserresize(new Rect(f.x,f.y,f.w,f.h))}}};var a=function(g){g=g||window.event;f.dragGripIndex=0;f.isDragging=false};if(document.addEventListener){document.addEventListener("mousemove",b,false);document.addEventListener("mouseup",a,false);document.addEventListener("touchmove",b,false);document.addEventListener("touchend",a,false)}else{if(document.attachEvent){document.attachEvent("onmousemove",b);document.attachEvent("onmouseup",a)}}}GripSet.prototype.NewGrip=function(c){var b=this;var a=document.createElement("div");a.style.position="absolute";a.style.lineHeight="0px";a.style.background="#000";a.style.width=GripSize+"px";a.style.height=GripSize+"px";a.appendChild(document.createComment(""));a.onmousedown=function(d){d=d||window.event;var e=GetMouseCoords(d);b.dragStartPos=e;b.dragStartRect=new Rect(b.x,b.y,b.w,b.h);b.dragGripIndex=c;b.isDragging=true;if(d.stopPropagation){d.stopPropagation()}d.cancelBubble=true;d.preventDefault?d.preventDefault():d.returnValue=false;return false};this.ownerElem.appendChild(a);return a};GripSet.prototype.UserResizeRect=function(a,e,b,d){if(this.onlimitsize){var c=new Rect(a,e,b,d);this.onlimitsize(c);a=c.x;e=c.y;b=c.w;d=c.h;if(b<0){b=0}if(d<0){d=0}}else{if(b<2){b=2}if(d<2){d=2}}this.ResizeRect(a,e,b,d)};GripSet.prototype.ResizeRect=function(a,d,b,c){this.x=a;this.y=d;this.w=b;this.h=c;this.gripTopLeft.style.left=(a-GripDistance-GripSize)+"px";this.gripTopLeft.style.top=(d-GripDistance-GripSize)+"px";this.gripTopRight.style.left=(a+b-1+GripDistance)+"px";this.gripTopRight.style.top=(d-GripDistance-GripSize)+"px";this.gripBottomLeft.style.left=(a-GripDistance-GripSize)+"px";this.gripBottomLeft.style.top=(d+c-1+GripDistance)+"px";this.gripBottomRight.style.left=(a+b-1+GripDistance)+"px";this.gripBottomRight.style.top=(d+c-1+GripDistance)+"px";if(this.groupCount==8){this.gripTop.style.left=(a+(b-GripSize)/2)+"px";this.gripTop.style.top=(d-GripDistance-GripSize)+"px";this.gripLeft.style.left=(a-GripDistance-GripSize)+"px";this.gripLeft.style.top=(d+(c-GripSize)/2)+"px";this.gripRight.style.left=(a+b-1+GripDistance)+"px";this.gripRight.style.top=(d+(c-GripSize)/2)+"px";this.gripBottom.style.left=(a+(b-GripSize)/2)+"px";this.gripBottom.style.top=(d+c-1+GripDistance)+"px"}if(this.onresize){this.onresize(new Rect(a,d,b,c))}};GripSet.prototype.IsVisible=function(){return this.gripTopLeft.style.visibility=="visible"};GripSet.prototype.Show=function(){this.gripTopLeft.style.visibility="visible";this.gripTopRight.style.visibility="visible";this.gripBottomLeft.style.visibility="visible";this.gripBottomRight.style.visibility="visible";if(this.groupCount==8){this.gripTop.style.visibility="visible";this.gripLeft.style.visibility="visible";this.gripRight.style.visibility="visible";this.gripBottom.style.visibility="visible"}};GripSet.prototype.Hide=function(){this.gripTopLeft.style.visibility="hidden";this.gripTopRight.style.visibility="hidden";this.gripBottomLeft.style.visibility="hidden";this.gripBottomRight.style.visibility="hidden";if(this.groupCount==8){this.gripTop.style.visibility="hidden";this.gripLeft.style.visibility="hidden";this.gripRight.style.visibility="hidden";this.gripBottom.style.visibility="hidden"}};