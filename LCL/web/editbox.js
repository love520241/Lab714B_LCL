function TextArea_SetWrap(a,b){a.setAttribute("wrap",b);if(navigator.userAgent.indexOf("Firefox")!=-1){var c=a.parentNode;var d=a.nextSibling;c.removeChild(a);c.insertBefore(a,d)}}var EditBoxModes={TypeWriter:1,TextBox:2};function EditBox(b,a){var c=this;this.debug=false;this.mode=null;this.ownerElem=a?a:document.body;this.onresize=null;this.ontextchange=null;if(navigator.userAgent.indexOf("Firefox")!=-1){this.deltaX=1}else{this.deltaX=0}this.textMeasure=new TextMeasure(this.ownerElem);this.borderDiv=document.createElement("div");this.borderDiv.style.position="absolute";this.ownerElem.appendChild(this.borderDiv);this.textEdit=document.createElement("textarea");this.textEdit.style.position="absolute";this.textEdit.style.overflow="hidden";this.textEdit.style.textAlign="left";this.textEdit.style.border="0px none";this.textEdit.style.padding="0px";this.textEdit.style.margin="0px";this.textEdit.style.background="url(#)";this.textEdit.style.backgroundRepeat="repeat";this.textEdit.style.color="rgb(0, 0, 0)";this.textEdit.style.backgroundColor="transparent";this.textEdit.style.outlineWidth="0px";this.textEdit.style.resize="none";this.textEdit.value="";this.textEdit.onmousedown=function(d){d=d||window.event;if(d.stopPropagation){d.stopPropagation()}d.cancelBubble=true};this.textEdit.onselectstart=function(){window.event.cancelBubble=true};this.ownerElem.appendChild(this.textEdit);this.borderDiv.style.border="1px dotted gray";this.borderDiv.style.backgroundColor="transparent";this.borderDiv.style.margin="-1px";this.borderDiv.onmousedown=function(d){d=d||window.event;d.preventDefault?d.preventDefault():d.returnValue=false;return false};this.borderDiv.onselectstart=function(){return false};if(this.debug){this.textEdit.style.border="1px solid black";this.textMeasure.measureDiv.style.border="1px solid black";this.textMeasure.measureDiv.style.visibility="visible";this.textMeasure.measureDiv.style.top="400px"}this.SetMode(b?b:EditBoxModes.TypeWriter);this.SetFont("Arial","12px",false,false);this.isKeyDown=false;this.textEdit.onchange=function(){c.UpdateEdit("change");if(c.ontextchange){c.ontextchange(c.textEdit.value)}};this.textEdit.onkeydown=function(d){c.UpdateEdit("keydown",d||window.event)};this.textEdit.onkeyup=function(){c.UpdateEdit("keyup")};this.UpdateEdit()}EditBox.prototype.UpdateEdit=function(a,d){if(a=="keydown"){this.isKeyDown=true}else{if(a=="keyup"){this.isKeyDown=false}}var e=d?d.keyCode==13:false;if(this.mode==EditBoxModes.TypeWriter){this.textMeasure.SetContent(this.textEdit.value,e);var c=50;var b=2;this.textEdit.style.width=this.textMeasure.GetWidth()+(this.isKeyDown?c:b)+"px";this.textEdit.style.height=this.textMeasure.GetHeight()+"px";if(this.textEdit.clientWidth<this.textEdit.scrollWidth){this.textEdit.style.width=this.textEdit.scrollWidth+2+"px"}this.borderDiv.style.left=clipPx(this.textEdit.style.left)+this.deltaX+"px";this.borderDiv.style.top=this.textEdit.style.top;this.borderDiv.style.width=this.textMeasure.GetWidth()+"px";this.borderDiv.style.height=this.textMeasure.GetHeight()+"px";if(this.onresize){this.onresize()}}else{if(this.mode==EditBoxModes.TextBox){if(this.textEdit.clientHeight<this.textEdit.scrollHeight){this.borderDiv.style.height=this.textEdit.style.height=this.textEdit.scrollHeight+2+"px";if(this.onresize){this.onresize()}}}}};EditBox.prototype.IsVisible=function(){return this.textEdit.style.visibility=="visible"};EditBox.prototype.Show=function(){this.textEdit.style.visibility="visible";this.borderDiv.style.visibility="visible"};EditBox.prototype.Hide=function(){this.textEdit.blur();this.textEdit.style.visibility="hidden";this.borderDiv.style.visibility="hidden"};EditBox.prototype.Focus=function(){this.textEdit.focus()};EditBox.prototype.GetMode=function(){return this.mode};EditBox.prototype.SetMode=function(a){if(this.mode!=a){this.mode=a;this.textEdit.style.whiteSpace=this.mode==EditBoxModes.TextBox?"pre-wrap":"pre";TextArea_SetWrap(this.textEdit,this.mode==EditBoxModes.TextBox?"soft":"off");if(this.isKeyDown&&this.mode==EditBoxModes.TextBox){this.textEdit.style.width=this.textMeasure.GetWidth()+"px";this.textEdit.style.height=this.textMeasure.GetHeight()+"px"}}};EditBox.prototype.GetBounds=function(){var b=GetElementPos(this.textEdit);if(this.ownerElem){var a=GetElementPos(this.ownerElem);b.x-=a.x;b.y-=a.y}if(this.mode==EditBoxModes.TypeWriter){return new Rect(b.x+this.deltaX,b.y,this.textMeasure.GetWidth(),this.textMeasure.GetHeight())}else{if(this.mode==EditBoxModes.TextBox){return new Rect(b.x+this.deltaX,b.y,this.textEdit.clientWidth,this.textEdit.clientHeight)}}};EditBox.prototype.SetBounds=function(a){if(this.mode==EditBoxModes.TextBox){this.textEdit.style.left=a.x-this.deltaX+"px";this.textEdit.style.top=a.y+"px";this.textEdit.style.width=a.w+"px";this.textEdit.style.height=a.h+"px";this.borderDiv.style.left=a.x+"px";this.borderDiv.style.top=a.y+"px";this.borderDiv.style.width=a.w+"px";this.borderDiv.style.height=a.h+"px";if(this.onresize){this.onresize()}}else{if(this.mode==EditBoxModes.TypeWriter){this.textEdit.style.left=a.x-this.deltaX+"px";this.textEdit.style.top=a.y+"px";this.borderDiv.style.left=a.x+"px";this.borderDiv.style.top=a.y+"px";this.UpdateEdit()}}};EditBox.prototype.SetPosition=function(a,b){this.textEdit.style.left=a-this.deltaX+"px";this.textEdit.style.top=b+"px";this.borderDiv.style.left=a+"px";this.borderDiv.style.top=b+"px";if(this.onresize){this.onresize()}};EditBox.prototype.SetFont=function(e,d,c,b,a){this.textEdit.style.fontFamily=e;this.textEdit.style.fontSize=d;this.textEdit.style.fontWeight=c?"bold":"normal";this.textEdit.style.fontStyle=b?"italic":"normal";this.textEdit.style.color=a?a:"rgb(0, 0, 0)";this.textMeasure.SetFont(e,d,c,b)};EditBox.prototype.SetStyle=function(g,f,e,b,a,c,d){this.SetFont(g,f,e,b,a);this.borderDiv.style.border=c?c:"1px dotted gray";if(d){this.textEdit.style.background=d}else{this.textEdit.style.background="url(#)"}};EditBox.prototype.Clear=function(){this.textEdit.value=""};EditBox.prototype.GetText=function(){return this.textEdit.value};EditBox.prototype.SetText=function(a){this.textEdit.value=a};EditBox.prototype.PopUp=function(c,a,b){this.SetMode(c);if(b){this.SetText(b)}else{this.Clear()}this.SetBounds(a);this.Show();this.Focus();SetCaretPosition(this.textEdit,0);this.textEdit.scrollTop="0px"};EditBox.prototype.Enable=function(){this.textEdit.onselectstart=function(){window.event.cancelBubble=true}};EditBox.prototype.Disable=function(){this.textEdit.onselectstart=function(){return false}};